import{m as e,j as s,A as a}from"./ui-DiyF1XNF.js";import{r as t,a as n,b as i,N as r}from"./router-Cl3Qa2eh.js";import{u as l,b as c}from"./queries-DfYPg-Jv.js";import{f as o,p as d,M as m}from"./ethers-BCvv8CP0.js";import{u,a as g,L as x,b as h,c as p}from"./index-BJXB6itt.js";import"./react-CFHJfABC.js";const b=({children:a,className:t="",withAnimation:n=!1,...i})=>{const r=n?e.div:"div",l=n?{whileHover:{y:-5,transition:{duration:.2}},transition:{duration:.2}}:{};return s.jsx(r,{className:`solid-panel p-6 rounded-2xl ${t}`,...l,...i,children:a})},y=(e,s=4)=>{if(!e)return"0";try{let a;a="string"==typeof e?BigInt(e):"number"==typeof e?BigInt(Math.floor(e)):e;const t=o(a);if(s>0){const e=t.split(".");if(2===e.length)return`${e[0]}.${e[1].substring(0,s)}`}return t}catch(a){return"0"}},f=e=>{if(!e||""===e)return BigInt(0);try{const s=e.replace(/[^0-9.]/g,"").split("."),a=s[0]+(s.length>1?"."+s[1]:"");return d(a)}catch(s){return BigInt(0)}},j=e=>{if(!e)return"Never";try{return new Date(1e3*e).toLocaleString()}catch(s){return"Invalid date"}},v=(e,s)=>{if(!e||s<=0)return BigInt(0);try{return("bigint"==typeof e?e:BigInt(e))*BigInt(Math.floor(100*s))/BigInt(1e4)}catch(a){return BigInt(0)}};const N=new class{constructor(){this.diceContract=null}init(e){if(!e||!e.dice)throw new Error("Dice contract not provided");this.diceContract=e.dice}async placeBet(e,s){if(!this.diceContract)throw new Error("Dice contract not initialized");if(!e||e<1||e>6)throw new Error("Invalid number selected. Choose a number between 1 and 6.");if(!s||s<=0)throw new Error("Invalid bet amount");try{const a=await this.diceContract.playDice(e,s),t=await a.wait();return t&&t.logs,{success:!0,transaction:t}}catch(a){throw this.parseContractError(a)}}async getUserStats(e){if(!this.diceContract||!e)return{gamesPlayed:0,totalWinnings:BigInt(0),lastPlayed:0};try{const[s,a,t]=await this.diceContract.getUserData(e);return{gamesPlayed:Number(s),totalWinnings:a,lastPlayed:Number(t)}}catch(s){throw s}}async getGameHistory(e){if(!this.diceContract||!e)return{games:[],stats:{totalGamesWon:0,totalGamesLost:0}};try{let a=[];try{a=await this.diceContract.getBetHistory(e)}catch(s){if("BAD_DATA"!==s.code||"0x"!==s.value)throw s;a=[]}const t=a.map((e=>({chosenNumber:Number(e[0]),rolledNumber:Number(e[1]),amount:e[2].toString(),timestamp:Number(e[3]),payout:e[4].toString(),isWin:Number(e[1])===Number(e[0])}))).reverse(),n=t.reduce(((e,s)=>({totalGamesWon:e.totalGamesWon+(s.isWin?1:0),totalGamesLost:e.totalGamesLost+(s.isWin?0:1)})),{totalGamesWon:0,totalGamesLost:0});return{games:t,stats:n}}catch(s){throw s}}calculatePotentialPayout(e){if(!e)return BigInt(0);try{return BigInt(e)*BigInt(6)}catch(s){return BigInt(0)}}parseContractError(e){const s=e.toString();return s.includes("insufficient funds")?new Error("Insufficient funds to place this bet"):s.includes("user rejected")?new Error("Transaction rejected by user"):s.includes("Invalid chosen number")?new Error("Please choose a number between 1 and 6"):s.includes("Bet amount cannot be zero")?new Error("Bet amount cannot be zero"):s.includes("Bet amount too large")?new Error("Bet amount exceeds the maximum allowed"):s.includes("Token burn failed")?new Error("Failed to place bet. Token transfer issue."):s.includes("InsufficientUserBalance")?new Error("Insufficient token balance"):s.includes("InsufficientAllowance")?new Error("Insufficient token allowance. Please approve tokens first."):s.includes("execution reverted")?new Error("Transaction failed. Please try again."):new Error("Failed to place bet: "+(e.message||"Unknown error"))}},w=({account:e})=>{const{data:a,isLoading:t}=l({queryKey:["gameStats",e],queryFn:async()=>{if(!e)return{gamesPlayed:0,totalWinnings:BigInt(0),lastPlayed:0};try{return await N.getUserStats(e)}catch(s){throw s}},refetchInterval:1e4,enabled:!!e});return t?s.jsxs("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-8 bg-secondary-800/50 rounded w-1/3"}),s.jsx("div",{className:"h-8 bg-secondary-800/50 rounded w-2/3"}),s.jsx("div",{className:"h-8 bg-secondary-800/50 rounded w-1/2"})]}):s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs(b,{className:"stat-card",children:[s.jsx("h3",{className:"text-secondary-400",children:"Games Played"}),s.jsx("p",{className:"text-2xl font-bold text-gaming-primary",children:(null==a?void 0:a.gamesPlayed)||0})]}),s.jsxs(b,{className:"stat-card",children:[s.jsx("h3",{className:"text-secondary-400",children:"Total Winnings"}),s.jsxs("p",{className:"text-2xl font-bold text-gaming-accent",children:[y((null==a?void 0:a.totalWinnings)||BigInt(0))," GAMA"]})]}),s.jsxs(b,{className:"stat-card",children:[s.jsx("h3",{className:"text-secondary-400",children:"Last Played"}),s.jsx("p",{className:"text-2xl font-bold text-gaming-primary",children:j(null==a?void 0:a.lastPlayed)})]})]})},k=({children:e,active:a,onClick:t})=>s.jsx("button",{onClick:t,className:"px-3 py-1 rounded-lg text-sm transition-colors "+(a?"bg-gaming-primary text-white":"bg-gaming-primary/20 text-gaming-primary hover:bg-gaming-primary/30"),children:e}),B=()=>s.jsxs("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-20 bg-secondary-800/50 rounded-xl w-full"}),s.jsx("div",{className:"h-20 bg-secondary-800/50 rounded-xl w-full"}),s.jsx("div",{className:"h-20 bg-secondary-800/50 rounded-xl w-full"})]}),C=()=>s.jsxs("div",{className:"flex flex-col items-center justify-center py-10 text-center",children:[s.jsx("div",{className:"w-20 h-20 rounded-full bg-secondary-800/50 flex items-center justify-center mb-4",children:s.jsx("svg",{className:"w-10 h-10 text-secondary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),s.jsx("h3",{className:"text-xl font-bold text-white/90 mb-2",children:"No games played yet"}),s.jsx("p",{className:"text-secondary-400 mb-6",children:"Your game history will appear here after you play."})]}),A=({game:a,index:t})=>{const n=e=>{if(!e||isNaN(e))return 1;const s=Number(e);return s<1||s>6?1:s};return s.jsx(e.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,delay:.05*t},className:"history-item "+(a.isWin?"bg-gaming-success/10":"bg-gaming-error/10"),children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white border-2 \n              "+(a.isWin?"border-gaming-success bg-gaming-success/20":"border-gaming-error bg-gaming-error/20"),children:n(a.rolledNumber)}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-semibold text-white",children:["You bet on"," ",s.jsx("span",{className:"font-bold text-gaming-primary",children:n(a.chosenNumber)})," ","and rolled a"," ",s.jsx("span",{className:a.isWin?"text-gaming-success":"text-gaming-error",children:n(a.rolledNumber)})]}),s.jsx("p",{className:"text-sm text-secondary-400",children:j(a.timestamp)})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"font-semibold "+(a.isWin?"text-gaming-success":"text-gaming-error"),children:a.isWin?`+${y(a.payout)} GAMA`:`-${y(a.amount)} GAMA`}),s.jsxs("p",{className:"text-xs text-secondary-400",children:["Bet: ",y(a.amount)," GAMA"]})]})]})})},I=({account:e})=>{const[n,i]=t.useState("all"),{data:r,isLoading:c}=l({queryKey:["gameHistory",e],queryFn:async()=>{if(!e)return{games:[],stats:{totalGamesWon:0,totalGamesLost:0}};try{return await N.getGameHistory(e)}catch(s){return{games:[],stats:{totalGamesWon:0,totalGamesLost:0}}}},refetchInterval:1e4,enabled:!!e}),o=t.useMemo((()=>(null==r?void 0:r.games)?"all"===n?r.games:"wins"===n?r.games.filter((e=>e.isWin)):"losses"===n?r.games.filter((e=>!e.isWin)):r.games:[]),[null==r?void 0:r.games,n]);return s.jsxs(b,{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsx("h2",{className:"text-2xl font-bold text-white/90",children:"Game History"}),(null==r?void 0:r.stats)&&s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("span",{className:"text-sm text-secondary-400",children:"Won"}),s.jsx("p",{className:"font-bold text-gaming-success",children:r.stats.totalGamesWon})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("span",{className:"text-sm text-secondary-400",children:"Lost"}),s.jsx("p",{className:"font-bold text-gaming-error",children:r.stats.totalGamesLost})]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(k,{active:"all"===n,onClick:()=>i("all"),children:"All Games"}),s.jsx(k,{active:"wins"===n,onClick:()=>i("wins"),children:"Wins"}),s.jsx(k,{active:"losses"===n,onClick:()=>i("losses"),children:"Losses"})]}),s.jsx("div",{className:"space-y-4",children:c?s.jsx(B,{}):0===o.length?s.jsx(C,{}):s.jsx(a,{children:o.map(((e,a)=>s.jsx(A,{game:e,index:a},e.timestamp)))})})]})},P={primary:"bg-gaming-primary hover:bg-gaming-primary/90 text-white",secondary:"bg-secondary-800 hover:bg-secondary-700 text-white",danger:"bg-gaming-error hover:bg-gaming-error/90 text-white",success:"bg-gaming-success hover:bg-gaming-success/90 text-white",warning:"bg-gaming-warning hover:bg-gaming-warning/90 text-white",info:"bg-gaming-info hover:bg-gaming-info/90 text-white",ghost:"bg-transparent hover:bg-secondary-800 text-white",outline:"bg-transparent border border-secondary-700 hover:border-gaming-primary text-white"},G={xs:"px-2 py-1 text-xs",sm:"px-3 py-1.5 text-sm",md:"px-4 py-2",lg:"px-6 py-3 text-lg",xl:"px-8 py-4 text-xl"},W=({children:a,variant:t="primary",size:n="md",className:i="",isLoading:r=!1,disabled:l=!1,withAnimation:c=!0,onClick:o,type:d="button",...m})=>{const u=P[t]||P.primary,g=G[n]||G.md,x=c?e.button:"button",h=c?{whileHover:{scale:1.03},whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:10}}:{};return s.jsxs(x,{type:d,className:`rounded-lg font-medium transition-all duration-300 inline-flex items-center justify-center ${u} ${g} disabled:opacity-50 disabled:cursor-not-allowed ${i}`,disabled:r||l,onClick:o,...h,...m,children:[r&&s.jsxs("svg",{className:"w-5 h-5 mr-2 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a]})},S=({label:e,id:a,name:t,type:n="text",placeholder:i,value:r,onChange:l,error:c,className:o="",leftIcon:d,rightIcon:m,disabled:u=!1,...g})=>s.jsxs("div",{className:"w-full",children:[e&&s.jsx("label",{htmlFor:a,className:"block text-white/80 text-sm font-medium mb-2",children:e}),s.jsxs("div",{className:"relative",children:[d&&s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-secondary-500",children:d}),s.jsx("input",{id:a,name:t,type:n,placeholder:i,value:r,onChange:l,disabled:u,className:`\n            input-gaming w-full\n            ${d?"pl-10":""}\n            ${m?"pr-10":""}\n            ${c?"border-gaming-error/50 focus:ring-gaming-error/50 focus:border-gaming-error":""}\n            ${u?"opacity-70 cursor-not-allowed":""}\n            ${o}\n          `,...g}),m&&s.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center text-secondary-500",children:m})]}),c&&s.jsx("p",{className:"mt-1 text-sm text-gaming-error",children:c})]}),L=({value:e,onChange:a,min:n="1",userBalance:i="0",disabled:r=!1})=>{const[l,c]=t.useState(""),[o,d]=t.useState(""),[m,u]=t.useState("");t.useEffect((()=>{try{if(e&&"0"!==e){const s=y(e,6);c(s)}else c("")}catch(s){}}),[e]);const g=t.useCallback((e=>{if(!e)return{isValid:!0};try{const s=f(e);return s<f(n)?{isValid:!1,error:`Minimum bet is ${y(n)} GAMA`}:s>BigInt(i)?{isValid:!1,error:"Insufficient balance"}:{isValid:!0}}catch(s){return{isValid:!1,error:"Invalid amount"}}}),[n,i]),x=t.useCallback((e=>{try{const s=f(e),t=g(e);t.isValid?(a(s),d("")):(a(s),d(t.error))}catch(s){d("Invalid amount")}}),[a,g]);t.useEffect((()=>{const e=setTimeout((()=>{m!==l&&x(m)}),300);return()=>clearTimeout(e)}),[m,l,x]);const h=e=>{if(!r&&i)try{const s=v(i,e),t=y(s,6);c(t),a(s);const n=g(t);n.isValid?d(""):d(n.error)}catch(s){}},p=e=>{if(!r)try{let s,t,n;s=l&&""!==l?f(l):BigInt(0),s===BigInt(0)?t=f("0.01"):(t=v(s,10),t===BigInt(0)&&(t=f("0.01"))),n=e?s+t:s>t?s-t:BigInt(0);const i=y(n,6);c(i),a(n);const r=g(i);r.isValid?d(""):d(r.error)}catch(s){}};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(S,{label:"Bet Amount (GAMA)",type:"text",value:l,onChange:e=>{const s=e.target.value;if(c(s),!s)return a(BigInt(0)),void d("");/^[0-9]*\.?[0-9]*$/.test(s)&&u(s)},placeholder:"0.0",disabled:r,error:o}),s.jsxs("div",{className:"mt-8 flex-shrink-0 flex flex-col space-y-2",children:[s.jsx(W,{variant:"outline",size:"sm",onClick:()=>p(!0),disabled:r,"aria-label":"Increase bet amount",children:"+"}),s.jsx(W,{variant:"outline",size:"sm",onClick:()=>p(!1),disabled:r||!l,"aria-label":"Decrease bet amount",children:"-"})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx(W,{size:"sm",variant:"outline",onClick:()=>h(.1),disabled:r,children:"10%"}),s.jsx(W,{size:"sm",variant:"outline",onClick:()=>h(.25),disabled:r,children:"25%"}),s.jsx(W,{size:"sm",variant:"outline",onClick:()=>h(.5),disabled:r,children:"50%"}),s.jsx(W,{size:"sm",variant:"outline",onClick:()=>h(.75),disabled:r,children:"75%"}),s.jsx(W,{size:"sm",variant:"outline",onClick:()=>h(1),disabled:r,children:"Max"})]})]})},M=({userBalance:n,allowance:i,potentialWinnings:r})=>{const[l,c]=t.useState(!1),d=e=>{if(!e||void 0===e)return"0";try{return o(e.toString())}catch(s){return"0"}},m=[{label:"Token Balance",value:d(n||0),icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},{label:"Token Allowance",value:(i||0)>0?"Approved":"Not Approved",icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},{label:"Potential Win",value:d(r||0),icon:s.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}],u=e=>{if("Approved"===e||"Not Approved"===e||"0"===e)return e;const s=parseFloat(e);return isNaN(s)||s<1?"0":new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}).format(s)};return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-2xl font-bold bg-clip-text text-transparent \n                       bg-gradient-to-r from-gaming-primary to-gaming-accent",children:"Balance Info"}),s.jsx("button",{onClick:()=>c(!l),className:"text-secondary-400 hover:text-white transition-colors",children:s.jsx("svg",{className:"w-6 h-6 transform transition-transform duration-300\n                          "+(l?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),s.jsx("div",{className:"grid grid-cols-1 gap-4",children:m.map(((a,t)=>s.jsx(e.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"balance-item",children:s.jsx("div",{className:"flex items-center justify-between p-4 rounded-xl\n                           bg-secondary-800/30 border border-secondary-700/30\n                           hover:border-gaming-primary/30 transition-all duration-300",children:s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg\n                               bg-gaming-primary/10 text-gaming-primary\n                               flex items-center justify-center",children:a.icon}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-secondary-400",children:a.label}),s.jsxs("p",{className:"font-medium text-white",children:[u(a.value)," ",s.jsx("span",{className:"text-sm text-secondary-400",children:"GAMA"})]})]})]})})},a.label)))}),s.jsx(a,{children:l&&s.jsx(e.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:s.jsx("div",{className:"pt-4 space-y-4",children:s.jsxs("div",{className:"p-4 rounded-xl bg-secondary-800/30 border border-secondary-700/30",children:[s.jsx("h3",{className:"text-lg font-medium mb-3",children:"Balance Details"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-secondary-400",children:"Available for Betting:"}),s.jsxs("span",{className:"text-white",children:[u(d((n||0)>(i||0)?i||0:n||0))," ","GAMA"]})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-secondary-400",children:"Win Multiplier:"}),s.jsx("span",{className:"text-gaming-success",children:"6x"})]}),s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-secondary-400",children:"Max Potential Win:"}),s.jsxs("span",{className:"text-gaming-primary",children:[u(d((n||BigInt(0))*BigInt(6)))," ","GAMA"]})]})]})]})})})})]})},E=e=>{if(!e||isNaN(e))return 1;const s=Number(e);return s<1||s>6?1:s},T=({chosenNumber:t,isRolling:n=!1,result:i=null})=>{const r=E(null!==i?i:t);return s.jsx("div",{className:"relative w-full max-w-[200px] mx-auto",children:s.jsx(a,{mode:"wait",children:s.jsx(e.div,{initial:{opacity:0,rotateX:-90,rotateY:-90},animate:{opacity:1,rotateX:n?[0,90,180,270,360]:0,rotateY:n?[0,90,180,270,360]:0},exit:{opacity:0,rotateX:90,rotateY:90},transition:n?{type:"spring",duration:1.5,repeat:1/0,repeatType:"loop"}:{type:"spring",stiffness:200,damping:15},className:"dice-container bg-secondary-900",children:s.jsx("div",{className:"dice-face bg-secondary-800",children:(e=>{switch(e){case 1:return s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full"})});case 2:return s.jsxs("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 p-4 gap-2",children:[s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-start"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-end"})]});case 3:return s.jsxs("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 p-4",children:[s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-start"}),s.jsx("div",{className:"col-start-2 row-start-2 w-5 h-5 bg-gaming-primary rounded-full place-self-center"}),s.jsx("div",{className:"col-start-3 row-start-3 w-5 h-5 bg-gaming-primary rounded-full place-self-end"})]});case 4:return s.jsxs("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-2 p-4 gap-2",children:[s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-start"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-end"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-start"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-end"})]});case 5:return s.jsxs("div",{className:"absolute inset-0 grid grid-cols-3 grid-rows-3 p-4",children:[s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-start"}),s.jsx("div",{className:"col-start-3 row-start-1 w-5 h-5 bg-gaming-primary rounded-full place-self-end"}),s.jsx("div",{className:"col-start-2 row-start-2 w-5 h-5 bg-gaming-primary rounded-full place-self-center"}),s.jsx("div",{className:"col-start-1 row-start-3 w-5 h-5 bg-gaming-primary rounded-full place-self-start"}),s.jsx("div",{className:"col-start-3 row-start-3 w-5 h-5 bg-gaming-primary rounded-full place-self-end"})]});case 6:return s.jsxs("div",{className:"absolute inset-0 grid grid-cols-2 grid-rows-3 p-4 gap-2",children:[s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-start"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-end"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-center"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-center"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-end"}),s.jsx("div",{className:"w-5 h-5 bg-gaming-primary rounded-full place-self-start"})]});default:return null}})(r)})},n?"rolling":`dice-${r}`)})})},z=({value:a,onChange:t,disabled:n=!1})=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-white/80 text-sm font-medium",children:"Choose Number:"}),s.jsx("div",{className:"grid grid-cols-6 gap-2",children:[1,2,3,4,5,6].map((i=>s.jsx(e.button,{type:"button",disabled:n,whileHover:!n&&{scale:1.1},whileTap:!n&&{scale:.95},transition:{type:"spring",stiffness:400,damping:17},onClick:()=>t(i),className:`\n              number-button ${a===i?"border-gaming-primary shadow-glow":""}\n              ${n?"opacity-60 cursor-not-allowed":"hover:border-gaming-primary/70 hover:shadow-md"}\n            `,children:i},i)))})]}),$=(e,s,a,n)=>{var i;const r=c(),d=u(n,a),[x,h]=g(!1),[p,b]=g(!1),y=t.useRef(!1),{betAmount:f,betAmountString:j,setBetAmount:v,chosenNumber:N,setChosenNumber:w}=((e="1000000000000000000")=>{const[s,a]=t.useState(e),[n,i]=t.useState(null),r=t.useCallback((e=>{a("bigint"==typeof e?e.toString():e)}),[]);return{betAmount:t.useMemo((()=>{try{return BigInt(s)}catch(e){return BigInt(0)}}),[s]),betAmountString:s,setBetAmount:r,chosenNumber:n,setChosenNumber:i}})(),{gameState:k,setProcessingState:B,setRollingState:C,setLastResult:A}=(()=>{const[e,s]=t.useState({isProcessing:!1,isRolling:!1,lastResult:null});return{gameState:e,setProcessingState:t.useCallback((e=>{s((s=>({...s,isProcessing:e})))}),[]),setRollingState:t.useCallback((e=>{s((s=>({...s,isRolling:e})))}),[]),setLastResult:t.useCallback((e=>{s((s=>({...s,lastResult:e})))}),[])}})(),{data:I,isLoading:P}=l({queryKey:["balance",s,null==(i=null==e?void 0:e.token)?void 0:i.target],queryFn:async()=>{if(!(null==e?void 0:e.token)||!s)return null;const[a,t]=await Promise.all([e.token.balanceOf(s),e.token.allowance(s,e.dice.target)]);return{balance:a,allowance:t}},enabled:!!(null==e?void 0:e.token)&&!!s,refetchInterval:5e3,staleTime:2e3,cacheTime:3e5,retry:2});t.useEffect((()=>()=>{r.cancelQueries(["balance",s])}),[r,s]);const G=t.useCallback((async()=>{!((null==e?void 0:e.token)&&(null==e?void 0:e.dice)&&s)||f<=BigInt(0)||y.current||(y.current=!0,await h((async()=>{try{await(async(e,s,a,t,n,i)=>{if(!(e&&s&&a&&t))throw new Error("Missing required parameters for token approval");try{if(n(!0),await e.allowance(t,s)<a){const n=m,r=await e.approve(s,n);if(!(await r.wait()).status)throw new Error("Token approval transaction failed");if(await e.allowance(t,s)<a)throw new Error("Allowance not set correctly");return i("Token approval successful","success"),!0}return!0}catch(r){throw r}finally{n(!1)}})(e.token,e.dice.target,f,s,B,n),await r.invalidateQueries(["balance",s])}catch(a){d(a,"approveToken")}finally{y.current=!1}})))}),[e,s,f,r,n,d,h,B]),W=t.useCallback((async()=>{!((null==e?void 0:e.dice)&&s&&N)||f<=BigInt(0)||k.isProcessing||y.current||(y.current=!0,await b((async()=>{try{B(!0),C(!0),A(null);await e.token.allowance(s,e.dice.target)<f&&await G();const a=await e.dice.playDice(N,f),t=((e,s)=>e&&e.logs&&s?e.logs.map((e=>{try{return s.parseLog({topics:e.topics,data:e.data})}catch(a){return null}})).find((e=>e&&"GameResult"===e.name)):null)(await a.wait(),e.dice.interface);if(t){const[e,s,a,i,r]=t.args,l=r>0;C(!1),A(Number(a)),n(l?`Congratulations! You won ${o(r)} GAMA!`:"Better luck next time!",l?"success":"warning")}await r.invalidateQueries(["balance",s])}catch(a){d(a,"placeBet"),C(!1),A(null)}finally{B(!1),y.current=!1}})))}),[e,s,N,f,k.isProcessing,r,n,d,b,G,B,C,A]),S=t.useMemo((()=>({hasNoTokens:(null==I?void 0:I.balance)===BigInt(0),needsApproval:f>BigInt(0)&&(null==I?void 0:I.allowance)<f,canPlaceBet:!k.isProcessing&&!y.current&&null!=N&&f>BigInt(0)})),[I,f,N,k.isProcessing]);return{chosenNumber:N,betAmount:f,betAmountString:j,gameState:k,balanceData:I,balanceLoading:P,isApproving:x,isBetting:p,...S,setChosenNumber:w,setBetAmount:v,handleApproveToken:G,handlePlaceBet:W}},D=({contracts:n,account:i,onError:r,addToast:l})=>{const[c,o]=t.useState(!1),{chosenNumber:d,betAmount:m,gameState:u,balanceData:g,balanceLoading:h,hasNoTokens:p,needsApproval:b,setChosenNumber:y,setBetAmount:f,handleApproveToken:j,handlePlaceBet:v}=$(n,i,r,l);return s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s.jsxs("div",{className:"space-y-10",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-4xl font-bold text-gradient-gaming mb-4",children:"Dice Game"}),s.jsx("p",{className:"text-secondary-400 text-lg",children:"Choose a number, place your bet, and test your luck!"})]}),h&&s.jsx("div",{className:"solid-panel p-4",children:s.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[s.jsx(x,{size:"small"}),s.jsx("span",{className:"text-secondary-400",children:"Updating balance..."})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"solid-panel p-8",children:[s.jsx("h2",{className:"text-2xl font-bold mb-8 text-white/90",children:"Place Your Bet"}),s.jsx("div",{className:"mb-8",children:s.jsx(z,{value:d,onChange:y,disabled:u.isProcessing})}),s.jsxs("div",{className:"mb-8",children:[s.jsx(L,{value:m,onChange:f,userBalance:(null==g?void 0:g.balance.toString())||"0",disabled:u.isProcessing||p,diceContract:null==n?void 0:n.dice}),p&&s.jsx("p",{className:"text-red-500 mt-2 text-sm",children:"You don't have any tokens to play. Please acquire tokens first."})]}),s.jsxs("div",{className:"flex flex-col gap-4",children:[b&&s.jsx("button",{onClick:j,disabled:u.isProcessing,className:"btn-gaming h-14 w-full",children:u.isProcessing?s.jsxs("span",{className:"flex items-center justify-center",children:[s.jsx(x,{size:"small"}),s.jsx("span",{className:"ml-2",children:"Approving..."})]}):"Approve Tokens"}),s.jsx("button",{onClick:v,disabled:!d||m<=BigInt(0)||((null==g?void 0:g.allowance)||BigInt(0))<m||u.isProcessing||!(null==n?void 0:n.dice),className:"btn-gaming h-14 w-full",children:u.isProcessing?s.jsxs("span",{className:"flex items-center justify-center",children:[s.jsx(x,{size:"small"}),s.jsx("span",{className:"ml-2",children:u.isRolling?"Rolling Dice...":"Processing..."})]}):"Roll Dice"})]})]}),s.jsxs("div",{className:"solid-panel p-8",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6 text-white/90",children:"Game Visualization"}),s.jsx(T,{isRolling:u.isRolling,rolledNumber:u.lastResult,chosenNumber:d})]})]}),s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"solid-panel p-8",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6 text-white/90",children:"Your Balance"}),s.jsx(M,{userBalance:(null==g?void 0:g.balance)||BigInt(0),isLoading:h,account:i,contracts:n})]}),s.jsxs("div",{className:"solid-panel p-8",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-white/90",children:c?"Game Stats":"Game History"}),s.jsx(k,{onClick:()=>o(!c),isActive:c,text:c?"View History":"View Stats"})]}),s.jsx(a,{mode:"wait",children:c?s.jsx(e.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},children:s.jsx(w,{account:i,diceContract:null==n?void 0:n.dice,onError:r})},"stats"):s.jsx(e.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},children:s.jsx(I,{account:i,diceContract:null==n?void 0:n.dice,onError:r})},"history")})]})]})]})]})})},R=()=>{const{contracts:e,account:a,handleErrorWithToast:t}=h(),{addToast:l}=p();return s.jsxs(n,{children:[s.jsx(i,{path:"/",element:s.jsx(D,{contracts:e,account:a,onError:t,addToast:l})}),s.jsx(i,{path:"*",element:s.jsx(r,{to:"/",replace:!0})})]})};export{R as default};
